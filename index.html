<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fat Rat: iPhone Edition</title>
  <style>
    :root {
      --bg-top: #111827;
      --bg-bottom: #1f2937;
      --glass: rgba(255, 255, 255, 0.12);
      --glass-strong: rgba(255, 255, 255, 0.2);
      --text: #f8fafc;
      --muted: #cbd5e1;
      --accent: #60a5fa;
      --good: #34d399;
      --danger: #fb7185;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: "SF Pro Text", "Helvetica Neue", Arial, sans-serif;
      color: var(--text);
      background:
        radial-gradient(circle at 20% 0%, #3b82f6 0%, transparent 36%),
        radial-gradient(circle at 80% 100%, #8b5cf6 0%, transparent 32%),
        linear-gradient(160deg, var(--bg-top), var(--bg-bottom));
      display: grid;
      grid-template-rows: auto 1fr;
    }

    .top-panel {
      position: sticky;
      top: 0;
      z-index: 30;
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      backdrop-filter: blur(12px);
      background: rgba(15, 23, 42, 0.6);
      border-bottom: 1px solid rgba(255,255,255,.15);
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(8, minmax(90px, 1fr));
      gap: 8px;
    }

    .pill {
      border-radius: 16px;
      padding: 9px 10px;
      background: linear-gradient(180deg, rgba(255,255,255,.2), rgba(255,255,255,.09));
      border: 1px solid rgba(255,255,255,.2);
      text-align: center;
      font-weight: 700;
      font-size: 0.86rem;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.35);
    }

    .button-row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .ios-btn {
      border: none;
      border-radius: 14px;
      padding: 10px 14px;
      color: white;
      background: linear-gradient(180deg, #60a5fa, #2563eb);
      font-weight: 700;
      box-shadow: 0 8px 16px rgba(37,99,235,.35), inset 0 1px 0 rgba(255,255,255,.35);
      cursor: pointer;
    }

    .ios-btn.secondary {
      background: linear-gradient(180deg, #a78bfa, #7c3aed);
      box-shadow: 0 8px 16px rgba(124,58,237,.35), inset 0 1px 0 rgba(255,255,255,.35);
    }

    .ios-btn:disabled {
      opacity: .5;
      cursor: not-allowed;
      box-shadow: none;
    }

    #gameArea {
      margin: 12px;
      border-radius: 24px;
      position: relative;
      overflow: hidden;
      border: 1px solid rgba(255,255,255,.2);
      background: linear-gradient(150deg, rgba(255,255,255,.08), rgba(0,0,0,.35));
      min-height: 68vh;
    }

    .rat {
      position: absolute;
      width: 64px;
      height: 48px;
      border-radius: 54% 46% 50% 50%;
      transform-origin: center;
      transition: transform .08s linear;
      background: radial-gradient(circle at 30% 30%, var(--rat-primary, #f5d0fe), var(--rat-secondary, #a78bfa) 72%);
      box-shadow: inset -10px -8px rgba(0,0,0,.2), 0 8px 12px rgba(0,0,0,.35);
    }
    .rat::before,.rat::after {
      content: "";
      position: absolute;
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: color-mix(in oklab, var(--rat-primary, #f5d0fe) 80%, white);
      top: -5px;
      border: 2px solid rgba(0,0,0,.2);
    }
    .rat::before { left: 8px; }
    .rat::after { right: 8px; }
    .rat .eye { position: absolute; width: 6px; height: 6px; border-radius: 50%; top: 15px; right: 12px; background: var(--rat-eye, #111); box-shadow: -16px 1px 0 var(--rat-eye, #111); }
    .rat .nose { position: absolute; width: 9px; height: 7px; right: -2px; top: 20px; border-radius: 50%; background: var(--rat-nose, #fb7185); }
    .rat .tail { position: absolute; width: 36px; height: 8px; left: -28px; top: 26px; border-radius: var(--rat-tail-radius, 10px); transform: rotate(-10deg); background: linear-gradient(90deg, var(--rat-tail-a, #c084fc), var(--rat-tail-b, #f9a8d4)); }
    .rat .stripe { position:absolute; left: 8px; top: 8px; width: 36px; height: 4px; border-radius: 8px; background: rgba(255,255,255,.45); transform: rotate(-10deg); }
    .rat .stripe.two { top: 16px; width: 28px; opacity: .7; }

    .food {
      position: absolute;
      width: 28px;
      height: 28px;
      font-size: 24px;
      display: grid;
      place-items: center;
      pointer-events: none;
    }


    .enemy {
      position: absolute;
      width: 34px;
      height: 34px;
      font-size: 28px;
      display: grid;
      place-items: center;
      filter: drop-shadow(0 6px 6px rgba(0,0,0,.35));
      pointer-events: none;
    }

    .pickup {
      position: absolute;
      width: 30px;
      height: 30px;
      font-size: 24px;
      display: grid;
      place-items: center;
      pointer-events: none;
    }

    .modal {
      position: fixed;
      inset: 0;
      background: rgba(2,6,23,.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 50;
      padding: 16px;
      backdrop-filter: blur(8px);
    }

    .modal.open { display: flex; }

    .sheet {
      width: min(760px, 100%);
      max-height: 85vh;
      overflow: auto;
      border-radius: 22px;
      padding: 16px;
      background: linear-gradient(180deg, rgba(255,255,255,.22), rgba(255,255,255,.12));
      border: 1px solid rgba(255,255,255,.25);
    }

    .row { display: flex; align-items: center; justify-content: space-between; gap: 10px; margin: 10px 0; }
    .card { border-radius: 16px; padding: 12px; background: rgba(15,23,42,.45); border: 1px solid rgba(255,255,255,.15); }

    input, select {
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,.25);
      background: rgba(15,23,42,.45);
      color: white;
      padding: 8px;
    }

    .leaderboard-item { display: grid; grid-template-columns: 28px 1fr auto; gap: 8px; padding: 8px 6px; border-bottom: 1px solid rgba(255,255,255,.1); }
    .status { font-weight: 700; min-height: 22px; color: #fde68a; margin-top: 6px; }

    .mobile-controls {
      position: fixed;
      z-index: 45;
      bottom: 14px;
      left: 50%;
      transform: translateX(-50%);
      width: min(340px, calc(100vw - 24px));
      display: none;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
      padding: 10px;
      border-radius: 18px;
      backdrop-filter: blur(10px);
      background: rgba(15, 23, 42, 0.7);
      border: 1px solid rgba(255,255,255,.2);
    }

    .pad-btn {
      border: none;
      border-radius: 14px;
      min-height: 48px;
      font-size: 1.3rem;
      color: white;
      background: linear-gradient(180deg, rgba(96,165,250,.95), rgba(37,99,235,.95));
      box-shadow: inset 0 1px 0 rgba(255,255,255,.35);
      touch-action: none;
    }

    .pad-btn.empty { visibility: hidden; }

    .mode-chip {
      display: inline-block;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.2);
      background: rgba(2,6,23,.35);
      font-size: .8rem;
      margin-top: 4px;
    }

    .small-input {
      width: 90px;
      text-align: center;
    }

    @media (max-width: 760px) {
      .stats { grid-template-columns: repeat(3, 1fr); }
      #gameArea { min-height: 58vh; margin-bottom: 130px; }
      .mobile-controls { display: grid; }
    }
  </style>
</head>
<body>
  <header class="top-panel">
    <div class="stats">
      <div class="pill">üêÄ Fat <span id="fatStat">0</span></div>
      <div class="pill">üßÄ Coins <span id="coinStat">0</span></div>
      <div class="pill">üìà Earned <span id="earnedStat">0</span></div>
      <div class="pill">üåç <span id="zoneStat">Alley</span></div>
      <div class="pill">‚ö° <span id="modeStat">Classic</span></div>
      <div class="pill">üî• Combo <span id="comboStat">x1</span></div>
      <div class="pill">‚ù§Ô∏è HP <span id="hpStat">100</span></div>
      <div class="pill">üåä Wave <span id="waveStat">1</span></div>
    </div>
    <div class="button-row">
      <button class="ios-btn" id="openShopBtn">Boosts</button>
      <button class="ios-btn secondary" id="openZonesBtn">Zones</button>
      <button class="ios-btn" id="openRatBtn">Customize Rat</button>
      <button class="ios-btn secondary" id="openPcBtn">PC Accessories</button>
      <button class="ios-btn secondary" id="openLeaderboardBtn">World Leaderboard</button>
      <button class="ios-btn" id="openModesBtn">Game Modes</button>
    </div>
    <div class="pill">Move with WASD / Arrow Keys ‚Ä¢ Survive waves</div>
    <div class="status" id="statusMsg"></div>
  </header>

  <main id="gameArea" aria-label="Fat Rat Game Arena">
    <div id="rat" class="rat"><span class="tail"></span><span class="eye"></span><span class="nose"></span></div>
  </main>

  <div class="modal" id="shopModal">
    <div class="sheet">
      <div class="row"><h2>üõí Boost Shop</h2><button class="ios-btn secondary" data-close="#shopModal">Close</button></div>
      <div id="shopList"></div>
    </div>
  </div>

  <div class="modal" id="zonesModal">
    <div class="sheet">
      <div class="row"><h2>üîì Zones</h2><button class="ios-btn secondary" data-close="#zonesModal">Close</button></div>
      <div id="zonesList"></div>
    </div>
  </div>

  <div class="modal" id="ratModal">
    <div class="sheet">
      <div class="row"><h2>üé® Customize Rat</h2><button class="ios-btn secondary" data-close="#ratModal">Close</button></div>
      <div class="card">
        <div class="row"><label>Rat Name</label><input id="ratNameInput" maxlength="18" placeholder="Chunky" /></div>
        <div class="row"><label>Primary Color</label><input id="ratPrimaryInput" type="color" value="#f5d0fe" /></div>
        <div class="row"><label>Secondary Color</label><input id="ratSecondaryInput" type="color" value="#a78bfa" /></div>
        <div class="row"><label>Eye Color</label><input id="ratEyeInput" type="color" value="#111111" /></div>
        <div class="row"><label>Nose Color</label><input id="ratNoseInput" type="color" value="#fb7185" /></div>
        <div class="row"><label>Tail Style</label><select id="ratTailInput"><option value="smooth">Smooth</option><option value="chunky">Chunky</option><option value="spike">Spike</option></select></div>
        <div class="row"><label>Pattern</label><select id="ratPatternInput"><option value="none">None</option><option value="stripes">Stripes</option></select></div>
        <div class="row"><label>Accessory</label>
          <select id="ratAccessoryInput">
            <option value="none">None</option>
            <option value="crown">Crown üëë</option>
            <option value="cap">Cap üß¢</option>
            <option value="glasses">Glasses üï∂Ô∏è</option>
          </select>
        </div>
        <button class="ios-btn" id="saveRatBtn">Save Customization</button>
      </div>
    </div>
  </div>


  <div class="modal" id="pcModal">
    <div class="sheet">
      <div class="row"><h2>üíª PC Accessories</h2><button class="ios-btn secondary" data-close="#pcModal">Close</button></div>
      <div class="card" style="margin-bottom:10px">Equipped accessories spawn in the arena as pickups for bonus coins/fat.</div>
      <div id="pcList"></div>
    </div>
  </div>

  <div class="modal" id="modesModal">
    <div class="sheet">
      <div class="row"><h2>üéÆ Game Modes</h2><button class="ios-btn secondary" data-close="#modesModal">Close</button></div>
      <div id="modesList"></div>
    </div>
  </div>

  <div class="modal" id="leaderboardModal">
    <div class="sheet">
      <div class="row"><h2>üèÜ World Leaderboard</h2><button class="ios-btn secondary" data-close="#leaderboardModal">Close</button></div>
      <div class="card">
        <div><strong>Auto-sync is ON</strong></div>
        <div style="color: var(--muted); margin-top:6px">Your rat is added/updated automatically while you play via online API.</div>
        <div id="myRankText" style="margin-top:8px;font-weight:700"></div>
      </div>
      <div class="card" style="margin-top:10px">
        <div id="leaderboardList"></div>
      </div>
    </div>
  </div>

  <div class="mobile-controls" id="mobileControls" aria-label="Touch controls">
    <button class="pad-btn empty" tabindex="-1">‚Ä¢</button>
    <button class="pad-btn" data-touch="up">‚¨ÜÔ∏è</button>
    <button class="pad-btn empty" tabindex="-1">‚Ä¢</button>
    <button class="pad-btn" data-touch="left">‚¨ÖÔ∏è</button>
    <button class="pad-btn" data-touch="down">‚¨áÔ∏è</button>
    <button class="pad-btn" data-touch="right">‚û°Ô∏è</button>
  </div>

  <script>
    const zones = [
      { name: "Alley", unlockAt: 0, foodRate: 1120, foodFat: 1, bg: "linear-gradient(160deg,#334155,#1e293b)" },
      { name: "Food Court", unlockAt: 35, foodRate: 920, foodFat: 2, bg: "linear-gradient(160deg,#065f46,#022c22)" },
      { name: "Mega Buffet", unlockAt: 90, foodRate: 780, foodFat: 3, bg: "linear-gradient(160deg,#7f1d1d,#450a0a)" },
      { name: "Cosmic Kitchen", unlockAt: 180, foodRate: 660, foodFat: 4, bg: "linear-gradient(160deg,#312e81,#1e1b4b)" },
      { name: "Sewer Speedway", unlockAt: 280, foodRate: 620, foodFat: 5, bg: "linear-gradient(160deg,#0f766e,#134e4a)" },
      { name: "Neon Diner", unlockAt: 420, foodRate: 560, foodFat: 6, bg: "linear-gradient(160deg,#7e22ce,#4c1d95)" },
      { name: "Sky Snack Deck", unlockAt: 600, foodRate: 520, foodFat: 7, bg: "linear-gradient(160deg,#1d4ed8,#1e3a8a)" },
      { name: "Volcano Grill", unlockAt: 820, foodRate: 480, foodFat: 8, bg: "linear-gradient(160deg,#b91c1c,#7f1d1d)" },
      { name: "Candy Crater", unlockAt: 1080, foodRate: 450, foodFat: 9, bg: "linear-gradient(160deg,#be185d,#831843)" },
      { name: "Royal Fridge", unlockAt: 1400, foodRate: 420, foodFat: 10, bg: "linear-gradient(160deg,#4338ca,#1e1b4b)" },
      { name: "Burger Galaxy", unlockAt: 1800, foodRate: 390, foodFat: 12, bg: "linear-gradient(160deg,#0f172a,#020617)" },
      { name: "Infinity Pantry", unlockAt: 2300, foodRate: 350, foodFat: 14, bg: "linear-gradient(160deg,#14532d,#052e16)" },
      { name: "God Rat Realm", unlockAt: 3000, foodRate: 300, foodFat: 18, bg: "linear-gradient(160deg,#4c0519,#111827)" },
      { name: "Cheese Singularity", unlockAt: 4000, foodRate: 260, foodFat: 25, bg: "linear-gradient(160deg,#713f12,#292524)" }
    ];

    const shopItems = [
      { id: "speed", name: "Rocket Sneakers", cost: 12, desc: "+0.9 movement speed", apply: s => s.speed += 0.9 },
      { id: "mult", name: "Grease Booster", cost: 20, desc: "+1 fat per bite", apply: s => s.fatPerFood += 1 },
      { id: "spawn", name: "Snack Magnet", cost: 28, desc: "Faster food spawns", apply: s => s.spawnBoost += 160 },
      { id: "coin", name: "Golden Whiskers", cost: 25, desc: "+1 coin per food", apply: s => s.coinBoost += 1 },
      { id: "armor", name: "Cheese Armor", cost: 34, desc: "+10 max HP", apply: s => { s.maxHp += 10; s.hp = Math.min(s.maxHp, s.hp + 8); } },
      { id: "regen", name: "Regeneration Soda", cost: 45, desc: "+0.12 HP regen", apply: s => s.hpRegen += 0.12 },
      { id: "damage", name: "Spicy Bite", cost: 38, desc: "+1 rat damage", apply: s => s.damage += 1 },
      { id: "vacuum", name: "Vacuum Belly", cost: 50, desc: "+4 pickup hitbox", apply: s => s.hitboxBonus += 4 }
    ];

    const gameModes = [
      { id: "classic", name: "Classic", desc: "Balanced gameplay.", fatMul: 1, spawnMul: 1, coinBonus: 0, enemyMul: 1 },
      { id: "feast", name: "Feast Frenzy", desc: "Way more food and fat gain.", fatMul: 1.35, spawnMul: 0.75, coinBonus: 1, enemyMul: 0.95 },
      { id: "rush", name: "Turbo Rush", desc: "Fast rat, faster zone progression.", fatMul: 1.15, spawnMul: 0.85, coinBonus: 0, enemyMul: 1.05 },
      { id: "challenge", name: "Grease Challenge", desc: "Hard mode, but juicy rewards.", fatMul: 1.6, spawnMul: 1.25, coinBonus: 2, enemyMul: 1.2 },
      { id: "survival", name: "Rat Survival", desc: "Enemies hit harder, rewards scale.", fatMul: 1.5, spawnMul: 1.15, coinBonus: 2, enemyMul: 1.35 },
      { id: "bossrush", name: "Boss Rush", desc: "Bosses spawn faster.", fatMul: 1.35, spawnMul: 1.05, coinBonus: 2, enemyMul: 1.55 }
    ];

    const accessoryShopItems = [
      { id: "keyboard", name: "RGB Keyboard", cost: 70, bonus: "+0.5 speed", spawn: "‚å®Ô∏è", effect: s => s.speed += 0.5 },
      { id: "mouse", name: "Pro Mouse", cost: 80, bonus: "+1 damage", spawn: "üñ±Ô∏è", effect: s => s.damage += 1 },
      { id: "gpu", name: "Rat RTX", cost: 120, bonus: "+10% fat gain", spawn: "üß©", effect: s => s.pcFatBonus += 0.1 },
      { id: "headset", name: "Gamer Headset", cost: 90, bonus: "+0.15 HP regen", spawn: "üéß", effect: s => s.hpRegen += 0.15 }
    ];

    const state = {
      fat: 0,
      coins: 0,
      totalFatEarned: 0,
      speed: 3.2,
      fatPerFood: 1,
      spawnBoost: 0,
      coinBoost: 0,
      zoneIndex: 0,
      highestUnlockedZone: 0,
      keys: {},
      foods: [],
      lastSpawn: 0,
      rat: { x: 220, y: 180, w: 64, h: 48 },
      ratName: "Chunky",
      ratPrimary: "#f5d0fe",
      ratSecondary: "#a78bfa",
      ratEye: "#111111",
      ratNose: "#fb7185",
      ratTail: "smooth",
      ratPattern: "none",
      ratAccessory: "none",
      currentMode: "classic",
      modeFatMultiplier: 1,
      modeSpawnMultiplier: 1,
      modeCoinBonus: 0,
      modeEnemyMultiplier: 1,
      combo: 1,
      hp: 100,
      maxHp: 100,
      hpRegen: 0.08,
      damage: 2,
      hitboxBonus: 0,
      wave: 1,
      enemies: [],
      pickups: [],
      lastEnemySpawn: 0,
      lastPickupSpawn: 0,
      pcOwned: {},
      pcEquipped: {},
      pcFatBonus: 0,
      touch: { up: false, down: false, left: false, right: false },
      playerId: localStorage.getItem("fatRatPlayerId") || crypto.randomUUID(),
      remoteBoard: [],
      leaderboardError: "",
      lastSubmittedFat: Number(localStorage.getItem("fatRatLastSubmittedFat") || -1),
      leaderboardSyncInFlight: false,
      uiDirty: true
    };

    const gameArea = document.getElementById("gameArea");
    const ratEl = document.getElementById("rat");
    const fatStat = document.getElementById("fatStat");
    const coinStat = document.getElementById("coinStat");
    const earnedStat = document.getElementById("earnedStat");
    const zoneStat = document.getElementById("zoneStat");
    const modeStat = document.getElementById("modeStat");
    const comboStat = document.getElementById("comboStat");
    const hpStat = document.getElementById("hpStat");
    const waveStat = document.getElementById("waveStat");
    const statusMsg = document.getElementById("statusMsg");
    const shopList = document.getElementById("shopList");
    const zonesList = document.getElementById("zonesList");
    const pcList = document.getElementById("pcList");
    const modesList = document.getElementById("modesList");
    const leaderboardList = document.getElementById("leaderboardList");
    const myRankText = document.getElementById("myRankText");
    localStorage.setItem("fatRatPlayerId", state.playerId);

    function currentZone() { return zones[state.zoneIndex]; }

    function setStatus(msg, color = "#fde68a") {
      statusMsg.textContent = msg;
      statusMsg.style.color = color;
      clearTimeout(setStatus.timer);
      setStatus.timer = setTimeout(() => (statusMsg.textContent = ""), 2000);
    }

    function openModal(id) { document.querySelector(id).classList.add("open"); }
    function closeModal(id) { document.querySelector(id).classList.remove("open"); }

    function renderHUD() {
      fatStat.textContent = state.fat;
      coinStat.textContent = state.coins;
      earnedStat.textContent = state.totalFatEarned;
      zoneStat.textContent = currentZone().name;
      modeStat.textContent = gameModes.find(m => m.id === state.currentMode)?.name || "Classic";
      comboStat.textContent = `x${state.combo.toFixed(1)}`;
      hpStat.textContent = Math.round(state.hp);
      waveStat.textContent = state.wave;
      gameArea.style.background = currentZone().bg;

      const visualScale = Math.min(1 + state.fat * 0.016, 3.4);
      ratEl.style.transform = `scale(${visualScale})`;

      // Bigger fat = bigger collection hitbox
      const hitboxScale = Math.min(1 + state.fat * 0.01, 3.2);
      const pcHitboxBonus = state.pcEquipped.keyboard ? 8 : 0;
      state.rat.w = 64 * hitboxScale + state.hitboxBonus + pcHitboxBonus;
      state.rat.h = 48 * hitboxScale + state.hitboxBonus + pcHitboxBonus;

      ratEl.style.setProperty("--rat-primary", state.ratPrimary);
      ratEl.style.setProperty("--rat-secondary", state.ratSecondary);
      ratEl.style.setProperty("--rat-eye", state.ratEye);
      ratEl.style.setProperty("--rat-nose", state.ratNose);
      ratEl.style.setProperty("--rat-tail-radius", state.ratTail === "chunky" ? "16px" : state.ratTail === "spike" ? "2px" : "10px");
      ratEl.style.setProperty("--rat-tail-a", state.ratTail === "spike" ? "#f97316" : "#c084fc");
      ratEl.style.setProperty("--rat-tail-b", state.ratTail === "spike" ? "#ef4444" : "#f9a8d4");
      ratEl.dataset.accessory = state.ratAccessory;
      ratEl.textContent = "";
      ratEl.insertAdjacentHTML("beforeend", `<span class="tail"></span><span class="eye"></span><span class="nose"></span>${state.ratPattern === "stripes" ? `<span class="stripe"></span><span class="stripe two"></span>` : ""}${accessoryHTML(state.ratAccessory)}`);
    }

    function accessoryHTML(accessory) {
      if (accessory === "crown") return `<span style="position:absolute;top:-20px;left:20px;font-size:20px">üëë</span>`;
      if (accessory === "cap") return `<span style="position:absolute;top:-18px;left:18px;font-size:20px">üß¢</span>`;
      if (accessory === "glasses") return `<span style="position:absolute;top:10px;left:14px;font-size:18px">üï∂Ô∏è</span>`;
      return "";
    }

    function renderShop() {
      shopList.innerHTML = "";
      shopItems.forEach(item => {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `<div class="row"><div><strong>${item.name}</strong><div>${item.desc}</div><div>${item.cost} coins each</div></div><div><input class="small-input" type="number" min="1" value="1" data-qty="${item.id}" /><button class="ios-btn" data-buy="${item.id}" data-amount="1" ${state.coins >= item.cost ? "" : "disabled"}>Buy 1</button><button class="ios-btn secondary" data-buy="${item.id}" data-amount="custom">Buy x</button></div></div>`;
        shopList.appendChild(card);
      });
    }

    function renderPcShop() {
      pcList.innerHTML = "";
      accessoryShopItems.forEach(item => {
        const owned = state.pcOwned[item.id] || 0;
        const equipped = !!state.pcEquipped[item.id];
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `<div class="row"><div><strong>${item.name}</strong><div>${item.bonus}</div><div>Cost: ${item.cost} coins ‚Ä¢ Owned: ${owned}</div><div>Spawn pickup: ${item.spawn}</div></div><div><button class="ios-btn" data-pc-buy="${item.id}" ${state.coins >= item.cost ? "" : "disabled"}>Buy</button><button class="ios-btn secondary" data-pc-equip="${item.id}" ${owned < 1 ? "disabled" : ""}>${equipped ? "Unequip" : "Equip"}</button></div></div>`;
        pcList.appendChild(card);
      });
    }

    function renderZones() {
      zonesList.innerHTML = "";
      zones.forEach((zone, idx) => {
        const open = state.totalFatEarned >= zone.unlockAt;
        const current = idx === state.zoneIndex;
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `<div class="row"><div><strong>${zone.name}</strong><div>Unlock: ${zone.unlockAt} fat</div><div>Food bonus: +${zone.foodFat - 1}</div></div><button class="ios-btn secondary" data-zone="${idx}" ${(!open || current) ? "disabled" : ""}>${current ? "Current" : open ? "Travel" : "Locked"}</button></div>`;
        zonesList.appendChild(card);
      });
    }

    function renderModes() {
      modesList.innerHTML = "";
      gameModes.forEach(mode => {
        const active = state.currentMode === mode.id;
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `<div class="row"><div><strong>${mode.name}</strong><div>${mode.desc}</div><div class="mode-chip">Fat x${mode.fatMul} ‚Ä¢ Spawn x${mode.spawnMul} ‚Ä¢ +${mode.coinBonus} coins</div></div><button class="ios-btn" data-mode="${mode.id}" ${active ? "disabled" : ""}>${active ? "Active" : "Play"}</button></div>`;
        modesList.appendChild(card);
      });
    }

    function setGameMode(id) {
      const mode = gameModes.find(x => x.id === id);
      if (!mode) return;
      state.currentMode = mode.id;
      state.modeFatMultiplier = mode.fatMul;
      state.modeSpawnMultiplier = mode.spawnMul;
      state.modeCoinBonus = mode.coinBonus;
      state.modeEnemyMultiplier = mode.enemyMul || 1;
      state.uiDirty = true;
      setStatus(`Mode switched: ${mode.name}`, "#93c5fd");
    }

    const LEADERBOARD_API_BASE = "https://geraldburke.com/apps/simple-leaderboard/";
    const LEADERBOARD_GAME_ID = 32;

    function boardStorageKey() {
      const url = new URL(window.location.href);
      const board = (url.searchParams.get("board") || "global").replace(/[^a-z0-9_-]/gi, "").toLowerCase() || "global";
      return `fatRatWorldBoard:${board}`;
    }

    function readLocalBoard() {
      return JSON.parse(localStorage.getItem(boardStorageKey()) || "[]");
    }

    function writeLocalBoard(entries) {
      localStorage.setItem(boardStorageKey(), JSON.stringify(entries));
    }

    function normalizeLeaderboardPayload(payload) {
      if (!payload) return [];
      const rows = Array.isArray(payload)
        ? payload
        : payload.entries || payload.leaderboard || payload.scores || payload.data || [];

      return (Array.isArray(rows) ? rows : []).map(entry => {
        const id = String(entry.player_id || entry.playerId || entry.id || `legacy-${entry.name || entry.player || "rat"}`);
        const name = String(entry.name || entry.player || "Rat").slice(0, 18);
        const fat = Number(entry.score ?? entry.fat ?? entry.points ?? 0) || 0;
        return { id, name, fat };
      });
    }

    function buildLeaderboardUrl(params) {
      const search = new URLSearchParams(params);
      return `${LEADERBOARD_API_BASE}?${search.toString()}`;
    }

    async function fetchJsonLoose(url) {
      const response = await fetch(url, { method: "GET", mode: "cors" });
      if (!response.ok) return null;
      const text = await response.text();
      if (!text) return null;
      try {
        return JSON.parse(text);
      } catch (err) {
        const trimmed = text.trim();
        if ((trimmed.startsWith("{") && trimmed.endsWith("}")) || (trimmed.startsWith("[") && trimmed.endsWith("]"))) {
          return JSON.parse(trimmed);
        }
        return null;
      }
    }

    function jsonpRequest(params, timeoutMs = 6000) {
      return new Promise((resolve, reject) => {
        const callbackName = `fatRatJsonp_${Date.now()}_${Math.random().toString(36).slice(2)}`;
        const script = document.createElement("script");
        const timer = setTimeout(() => {
          cleanup();
          reject(new Error("JSONP timeout"));
        }, timeoutMs);

        function cleanup() {
          clearTimeout(timer);
          delete window[callbackName];
          script.remove();
        }

        window[callbackName] = payload => {
          cleanup();
          resolve(payload);
        };

        script.onerror = () => {
          cleanup();
          reject(new Error("JSONP failed"));
        };

        script.src = buildLeaderboardUrl({ ...params, callback: callbackName });
        document.head.appendChild(script);
      });
    }

    async function fetchRemoteLeaderboard() {
      const getVariants = [
        { action: "get", game_id: String(LEADERBOARD_GAME_ID) },
        { action: "get", game: String(LEADERBOARD_GAME_ID) },
        { action: "list", game_id: String(LEADERBOARD_GAME_ID) },
        { game_id: String(LEADERBOARD_GAME_ID) },
        { game: String(LEADERBOARD_GAME_ID) }
      ];

      for (const params of getVariants) {
        try {
          const payload = await fetchJsonLoose(buildLeaderboardUrl(params));
          const entries = normalizeLeaderboardPayload(payload);
          if (entries.length) {
            state.remoteBoard = entries;
            state.leaderboardError = "";
            return entries;
          }
        } catch (err) {
          // try next payload format
        }
      }

      for (const params of getVariants) {
        try {
          const payload = await jsonpRequest(params);
          const entries = normalizeLeaderboardPayload(payload);
          if (entries.length) {
            state.remoteBoard = entries;
            state.leaderboardError = "";
            return entries;
          }
        } catch (err) {
          // try next JSONP format
        }
      }

      state.leaderboardError = "API unavailable, showing cached/local leaderboard.";
      return [];
    }

    async function refreshLeaderboardFromApi() {
      const entries = await fetchRemoteLeaderboard();
      if (entries.length) state.uiDirty = true;
      renderLeaderboard();
      return entries;
    }

    async function submitRemoteScore(entry) {
      const submitVariants = [
        { action: "add", game_id: String(LEADERBOARD_GAME_ID), player_id: entry.id, name: entry.name, score: String(entry.fat) },
        { action: "submit", game_id: String(LEADERBOARD_GAME_ID), player_id: entry.id, name: entry.name, score: String(entry.fat) },
        { action: "add", game: String(LEADERBOARD_GAME_ID), player: entry.name, player_id: entry.id, points: String(entry.fat) },
        { game_id: String(LEADERBOARD_GAME_ID), player_id: entry.id, name: entry.name, score: String(entry.fat) }
      ];

      for (const params of submitVariants) {
        const url = buildLeaderboardUrl(params);
        try {
          const payload = await fetchJsonLoose(url);
          if (payload && payload.success === false) continue;
          return true;
        } catch (err) {
          // fallback to beacon image for static-hosted CORS limits
          const ping = new Image();
          ping.src = `${url}&_=${Date.now()}`;
          return true;
        }
      }

      return false;
    }

    function upsertLocalScore(entry) {
      const board = readLocalBoard();
      const existing = board.find(x => x.id === entry.id);
      if (existing && existing.fat >= entry.fat && existing.name === entry.name) return false;
      const updated = board.filter(x => x.id !== entry.id);
      updated.push(entry);
      writeLocalBoard(updated);
      return true;
    }

    async function syncMyScore(force = false) {
      if (state.leaderboardSyncInFlight) return;
      const mine = { id: state.playerId, name: state.ratName || "Chunky", fat: state.totalFatEarned };
      const changed = upsertLocalScore(mine);

      if (!force && !changed && mine.fat <= state.lastSubmittedFat) return;

      state.leaderboardSyncInFlight = true;
      const ok = await submitRemoteScore(mine);
      if (ok) {
        state.lastSubmittedFat = mine.fat;
        localStorage.setItem("fatRatLastSubmittedFat", String(state.lastSubmittedFat));
      }
      state.leaderboardSyncInFlight = false;
    }

    function combineBoards() {
      const npc = [
        { id: "npc-1", name: "BurgerBeast", fat: 420 },
        { id: "npc-2", name: "FriesPhantom", fat: 350 },
        { id: "npc-3", name: "CheeseWhale", fat: 260 },
        { id: "npc-4", name: "GreaseKing", fat: 200 }
      ];

      const map = new Map();
      [...readLocalBoard(), ...state.remoteBoard, ...npc].forEach(entry => {
        const id = entry.id || `legacy-${entry.name}`;
        const prev = map.get(id);
        if (!prev || (entry.fat || 0) > (prev.fat || 0)) map.set(id, { id, name: entry.name || "Rat", fat: Number(entry.fat) || 0 });
      });

      return [...map.values()].sort((a, b) => b.fat - a.fat).slice(0, 50);
    }

    function renderLeaderboard() {
      const board = combineBoards();
      leaderboardList.innerHTML = "";
      let myRank = null;
      board.forEach((entry, i) => {
        if (entry.id === state.playerId) myRank = i + 1;
        const row = document.createElement("div");
        row.className = "leaderboard-item";
        const mine = entry.id === state.playerId;
        row.style.background = mine ? "rgba(52, 211, 153, 0.2)" : "transparent";
        row.innerHTML = `<div>${i + 1}.</div><div>${entry.name}${mine ? " (You)" : ""}</div><div>${entry.fat} fat</div>`;
        leaderboardList.appendChild(row);
      });

      const errorText = state.leaderboardError ? ` ‚Ä¢ ${state.leaderboardError}` : "";
      myRankText.textContent = myRank ? `Your place: #${myRank} with ${state.totalFatEarned} fat${errorText}` : `Play to get ranked.${errorText}`;
    }

    function buyItem(id, amount = 1) {
      const item = shopItems.find(i => i.id === id);
      if (!item) return;
      const count = Math.max(1, Math.min(100, Number(amount) || 1));
      const total = item.cost * count;
      if (state.coins < total) {
        setStatus(`Need ${total} coins for ${count}x ${item.name}`, "#fca5a5");
        return;
      }
      state.coins -= total;
      for (let i = 0; i < count; i++) item.apply(state);
      state.uiDirty = true;
      setStatus(`Bought ${count}x ${item.name}!`, "#86efac");
    }

    function buyPcAccessory(id) {
      const item = accessoryShopItems.find(i => i.id === id);
      if (!item) return;
      if (state.coins < item.cost) return;
      state.coins -= item.cost;
      state.pcOwned[id] = (state.pcOwned[id] || 0) + 1;
      state.uiDirty = true;
      setStatus(`Bought ${item.name}`, "#86efac");
    }

    function togglePcEquip(id) {
      if (!(state.pcOwned[id] > 0)) return;
      state.pcEquipped[id] = !state.pcEquipped[id];
      state.uiDirty = true;
      setStatus(state.pcEquipped[id] ? `Equipped ${id}` : `Unequipped ${id}`, "#93c5fd");
    }

    function travelToZone(idx) {
      const zone = zones[idx];
      if (!zone) return;
      if (state.totalFatEarned < zone.unlockAt || state.zoneIndex === idx) return;
      state.zoneIndex = idx;
      state.uiDirty = true;
      setStatus(`Traveled to ${zone.name}`, "#86efac");
    }

    function maybeAutoUnlockAndTravel() {
      let newest = 0;
      for (let i = zones.length - 1; i >= 0; i--) {
        if (state.totalFatEarned >= zones[i].unlockAt) { newest = i; break; }
      }
      if (newest > state.highestUnlockedZone) {
        state.highestUnlockedZone = newest;
        state.zoneIndex = newest;
        state.uiDirty = true;
        setStatus(`${zones[newest].name} unlocked! Auto-traveled üöÄ`, "#86efac");
      }
    }

    function spawnEnemy() {
      const bossWave = state.wave % 5 === 0;
      const enemy = {
        id: `enemy-${Math.random().toString(36).slice(2)}`,
        x: Math.random() * Math.max(20, gameArea.clientWidth - 36),
        y: Math.random() * Math.max(20, gameArea.clientHeight - 36),
        speed: (bossWave ? 1.2 : 1.7) * state.modeEnemyMultiplier,
        hp: bossWave ? 16 + state.wave * 2 : 5 + state.wave,
        damage: bossWave ? 8 + Math.floor(state.wave / 2) : 3 + Math.floor(state.wave / 4),
        boss: bossWave,
        emoji: bossWave ? "üëπ" : "ü™≥"
      };
      state.enemies.push(enemy);
      const el = document.createElement("div");
      el.id = enemy.id;
      el.className = "enemy";
      el.style.left = `${enemy.x}px`;
      el.style.top = `${enemy.y}px`;
      el.textContent = enemy.emoji;
      gameArea.appendChild(el);
    }

    function spawnPcPickup() {
      const equipped = accessoryShopItems.filter(item => state.pcEquipped[item.id]);
      if (!equipped.length) return;
      const picked = equipped[Math.floor(Math.random() * equipped.length)];
      const pickup = {
        id: `pickup-${Math.random().toString(36).slice(2)}`,
        x: Math.random() * Math.max(30, gameArea.clientWidth - 34),
        y: Math.random() * Math.max(30, gameArea.clientHeight - 34),
        bonusFat: 3 + state.wave,
        bonusCoins: 5,
        emoji: picked.spawn
      };
      state.pickups.push(pickup);
      const el = document.createElement("div");
      el.id = pickup.id;
      el.className = "pickup";
      el.style.left = `${pickup.x}px`;
      el.style.top = `${pickup.y}px`;
      el.textContent = pickup.emoji;
      gameArea.appendChild(el);
    }

    function spawnFood() {
      const zone = currentZone();
      const emoji = Math.random() > 0.45 ? "üçî" : "üçü";
      const food = {
        id: Math.random().toString(36).slice(2),
        x: Math.random() * (gameArea.clientWidth - 32),
        y: Math.random() * (gameArea.clientHeight - 32),
        fatValue: zone.foodFat + state.fatPerFood - 1,
        coinValue: (emoji === "üçî" ? 3 : 2) + state.coinBoost,
        emoji
      };
      state.foods.push(food);
      const el = document.createElement("div");
      el.id = food.id;
      el.className = "food";
      el.style.left = `${food.x}px`;
      el.style.top = `${food.y}px`;
      el.textContent = food.emoji;
      gameArea.appendChild(el);
    }

    function intersects(a, b) {
      return a.x < b.x + b.w && a.x + a.w > b.x && a.y < b.y + b.h && a.y + a.h > b.y;
    }

    function clampRat() {
      state.rat.x = Math.max(2, Math.min(state.rat.x, gameArea.clientWidth - state.rat.w - 2));
      state.rat.y = Math.max(2, Math.min(state.rat.y, gameArea.clientHeight - state.rat.h - 2));
    }

    function updateRat() {
      const moveSpeed = state.speed + (state.currentMode === "rush" ? 0.9 : 0) + (state.pcEquipped.keyboard ? 0.5 : 0);
      if (state.keys.ArrowUp || state.keys.w || state.touch.up) state.rat.y -= moveSpeed;
      if (state.keys.ArrowDown || state.keys.s || state.touch.down) state.rat.y += moveSpeed;
      if (state.keys.ArrowLeft || state.keys.a || state.touch.left) state.rat.x -= moveSpeed;
      if (state.keys.ArrowRight || state.keys.d || state.touch.right) state.rat.x += moveSpeed;
      clampRat();
      ratEl.style.left = `${state.rat.x}px`;
      ratEl.style.top = `${state.rat.y}px`;
    }

    function collectFood() {
      const ratBox = { x: state.rat.x, y: state.rat.y, w: state.rat.w, h: state.rat.h };
      let gained = false;
      state.foods = state.foods.filter(food => {
        const hit = intersects(ratBox, { x: food.x, y: food.y, w: 24, h: 24 });
        if (!hit) return true;
        const comboBoost = Math.min(1 + (state.combo - 1) * 0.08, 2.2);
        const fatGain = Math.max(1, Math.round(food.fatValue * state.modeFatMultiplier * (1 + state.pcFatBonus) * comboBoost));
        state.fat += fatGain;
        state.totalFatEarned += fatGain;
        state.coins += food.coinValue + state.modeCoinBonus;
        state.combo = Math.min(state.combo + 1, 25);
        document.getElementById(food.id)?.remove();
        gained = true;
        return false;
      });
      if (gained) {
        state.uiDirty = true;
        syncMyScore();
      } else {
        state.combo = Math.max(1, state.combo - 0.03);
      }
    }

    function updateEnemies() {
      const ratCenterX = state.rat.x + state.rat.w / 2;
      const ratCenterY = state.rat.y + state.rat.h / 2;
      state.enemies.forEach(enemy => {
        const dx = ratCenterX - enemy.x;
        const dy = ratCenterY - enemy.y;
        const dist = Math.hypot(dx, dy) || 1;
        enemy.x += (dx / dist) * enemy.speed;
        enemy.y += (dy / dist) * enemy.speed;
        const enemyEl = document.getElementById(enemy.id);
        if (enemyEl) {
          enemyEl.style.left = `${enemy.x}px`;
          enemyEl.style.top = `${enemy.y}px`;
        }
      });

      const ratBox = { x: state.rat.x, y: state.rat.y, w: state.rat.w, h: state.rat.h };
      state.enemies = state.enemies.filter(enemy => {
        const enemyBox = { x: enemy.x, y: enemy.y, w: enemy.boss ? 40 : 30, h: enemy.boss ? 40 : 30 };
        if (intersects(ratBox, enemyBox)) {
          state.hp -= enemy.damage * 0.03;
          enemy.hp -= state.damage * 0.08;
        }
        if (enemy.hp <= 0) {
          state.coins += enemy.boss ? 30 : 8;
          state.totalFatEarned += enemy.boss ? 12 : 4;
          document.getElementById(enemy.id)?.remove();
          state.uiDirty = true;
          return false;
        }
        return true;
      });

      if (state.hp <= 0) {
        state.hp = state.maxHp;
        state.wave = Math.max(1, state.wave - 1);
        state.fat = Math.max(0, state.fat - 30);
        state.combo = 1;
        setStatus("You got bonked! Respawned with HP reset.", "#fca5a5");
      }
    }

    function collectPickups() {
      const ratBox = { x: state.rat.x, y: state.rat.y, w: state.rat.w, h: state.rat.h };
      state.pickups = state.pickups.filter(p => {
        if (!intersects(ratBox, { x: p.x, y: p.y, w: 28, h: 28 })) return true;
        state.totalFatEarned += p.bonusFat;
        state.coins += p.bonusCoins;
        state.fat += p.bonusFat;
        document.getElementById(p.id)?.remove();
        state.uiDirty = true;
        return false;
      });
    }

    function renderAll() {
      renderHUD();
      renderShop();
      renderZones();
      renderPcShop();
      renderModes();
      renderLeaderboard();
      state.uiDirty = false;
    }

    function gameLoop(ts) {
      const spawnEvery = Math.max(170, (currentZone().foodRate - state.spawnBoost) * state.modeSpawnMultiplier);
      if (ts - state.lastSpawn > spawnEvery && state.foods.length < 26) {
        spawnFood();
        state.lastSpawn = ts;
      }

      const targetEnemies = Math.min(4 + Math.floor(state.wave / 2), 20);
      const enemySpawnEvery = Math.max(500, 2800 - state.wave * 80);
      if (ts - state.lastEnemySpawn > enemySpawnEvery && state.enemies.length < targetEnemies) {
        spawnEnemy();
        state.lastEnemySpawn = ts;
      }

      if (ts - state.lastPickupSpawn > 6000) {
        spawnPcPickup();
        state.lastPickupSpawn = ts;
      }

      state.hp = Math.min(state.maxHp, state.hp + state.hpRegen);
      if (state.totalFatEarned > state.wave * 120) {
        state.wave += 1;
        state.uiDirty = true;
        setStatus(`Wave ${state.wave} started!`, "#93c5fd");
      }

      updateRat();
      collectFood();
      collectPickups();
      updateEnemies();
      maybeAutoUnlockAndTravel();

      if (state.uiDirty) renderAll();
      else renderHUD();

      requestAnimationFrame(gameLoop);
    }

    document.getElementById("openShopBtn").addEventListener("click", () => openModal("#shopModal"));
    document.getElementById("openZonesBtn").addEventListener("click", () => openModal("#zonesModal"));
    document.getElementById("openRatBtn").addEventListener("click", () => openModal("#ratModal"));
    document.getElementById("openPcBtn").addEventListener("click", () => openModal("#pcModal"));
    document.getElementById("openModesBtn").addEventListener("click", () => openModal("#modesModal"));
    document.getElementById("openLeaderboardBtn").addEventListener("click", async () => {
      openModal("#leaderboardModal");
      await refreshLeaderboardFromApi();
      await syncMyScore(true);
      await refreshLeaderboardFromApi();
    });

    document.querySelectorAll("[data-close]").forEach(btn => btn.addEventListener("click", () => closeModal(btn.dataset.close)));

    shopList.addEventListener("click", e => {
      const btn = e.target.closest("button[data-buy]");
      if (!btn) return;
      const itemId = btn.dataset.buy;
      let amount = Number(btn.dataset.amount || 1);
      if (btn.dataset.amount === "custom") {
        const input = shopList.querySelector(`input[data-qty="${itemId}"]`);
        amount = Number(input?.value || 1);
      }
      buyItem(itemId, amount);
    });

    pcList.addEventListener("click", e => {
      const buy = e.target.closest("button[data-pc-buy]");
      if (buy) {
        buyPcAccessory(buy.dataset.pcBuy);
        return;
      }
      const equip = e.target.closest("button[data-pc-equip]");
      if (equip) togglePcEquip(equip.dataset.pcEquip);
    });

    zonesList.addEventListener("click", e => {
      const btn = e.target.closest("button[data-zone]");
      if (!btn) return;
      travelToZone(Number(btn.dataset.zone));
    });

    modesList.addEventListener("click", e => {
      const btn = e.target.closest("button[data-mode]");
      if (!btn) return;
      setGameMode(btn.dataset.mode);
    });

    document.getElementById("saveRatBtn").addEventListener("click", () => {
      state.ratName = document.getElementById("ratNameInput").value.trim() || "Chunky";
      state.ratPrimary = document.getElementById("ratPrimaryInput").value;
      state.ratSecondary = document.getElementById("ratSecondaryInput").value;
      state.ratEye = document.getElementById("ratEyeInput").value;
      state.ratNose = document.getElementById("ratNoseInput").value;
      state.ratTail = document.getElementById("ratTailInput").value;
      state.ratPattern = document.getElementById("ratPatternInput").value;
      state.ratAccessory = document.getElementById("ratAccessoryInput").value;
      state.uiDirty = true;
      syncMyScore(true);
      renderLeaderboard();
      setStatus("Rat customization saved!", "#86efac");
    });


    window.addEventListener("keydown", e => {
      state.keys[e.key] = true;
      state.keys[e.key.toLowerCase()] = true;
    });

    window.addEventListener("keyup", e => {
      state.keys[e.key] = false;
      state.keys[e.key.toLowerCase()] = false;
    });

    const mobileControls = document.getElementById("mobileControls");
    mobileControls.querySelectorAll("[data-touch]").forEach(btn => {
      const dir = btn.dataset.touch;
      const down = event => {
        event.preventDefault();
        state.touch[dir] = true;
      };
      const up = event => {
        event.preventDefault();
        state.touch[dir] = false;
      };
      btn.addEventListener("pointerdown", down);
      btn.addEventListener("pointerup", up);
      btn.addEventListener("pointerleave", up);
      btn.addEventListener("pointercancel", up);
    });

    window.addEventListener("resize", clampRat);

    async function initializeLeaderboardOnJoin() {
      await refreshLeaderboardFromApi();
      await syncMyScore(true);
      await refreshLeaderboardFromApi();
      setInterval(() => {
        refreshLeaderboardFromApi();
      }, 20000);
    }

    setGameMode("classic");
    renderAll();
    initializeLeaderboardOnJoin();
    requestAnimationFrame(gameLoop);
  </script>
</body>
</html>
