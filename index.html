<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fat Rat: iPhone Edition</title>
  <style>
    :root {
      --bg-top: #111827;
      --bg-bottom: #1f2937;
      --glass: rgba(255, 255, 255, 0.12);
      --glass-strong: rgba(255, 255, 255, 0.2);
      --text: #f8fafc;
      --muted: #cbd5e1;
      --accent: #60a5fa;
      --good: #34d399;
      --danger: #fb7185;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: "SF Pro Text", "Helvetica Neue", Arial, sans-serif;
      color: var(--text);
      background:
        radial-gradient(circle at 20% 0%, #3b82f6 0%, transparent 36%),
        radial-gradient(circle at 80% 100%, #8b5cf6 0%, transparent 32%),
        linear-gradient(160deg, var(--bg-top), var(--bg-bottom));
      display: grid;
      grid-template-rows: auto 1fr;
    }

    .top-panel {
      position: sticky;
      top: 0;
      z-index: 30;
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      backdrop-filter: blur(12px);
      background: rgba(15, 23, 42, 0.6);
      border-bottom: 1px solid rgba(255,255,255,.15);
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(4, minmax(90px, 1fr));
      gap: 8px;
    }

    .pill {
      border-radius: 16px;
      padding: 9px 10px;
      background: linear-gradient(180deg, rgba(255,255,255,.2), rgba(255,255,255,.09));
      border: 1px solid rgba(255,255,255,.2);
      text-align: center;
      font-weight: 700;
      font-size: 0.86rem;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.35);
    }

    .button-row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .ios-btn {
      border: none;
      border-radius: 14px;
      padding: 10px 14px;
      color: white;
      background: linear-gradient(180deg, #60a5fa, #2563eb);
      font-weight: 700;
      box-shadow: 0 8px 16px rgba(37,99,235,.35), inset 0 1px 0 rgba(255,255,255,.35);
      cursor: pointer;
    }

    .ios-btn.secondary {
      background: linear-gradient(180deg, #a78bfa, #7c3aed);
      box-shadow: 0 8px 16px rgba(124,58,237,.35), inset 0 1px 0 rgba(255,255,255,.35);
    }

    .ios-btn:disabled {
      opacity: .5;
      cursor: not-allowed;
      box-shadow: none;
    }

    #gameArea {
      margin: 12px;
      border-radius: 24px;
      position: relative;
      overflow: hidden;
      border: 1px solid rgba(255,255,255,.2);
      background: linear-gradient(150deg, rgba(255,255,255,.08), rgba(0,0,0,.35));
      min-height: 68vh;
    }

    .rat {
      position: absolute;
      width: 64px;
      height: 48px;
      border-radius: 54% 46% 50% 50%;
      transform-origin: center;
      transition: transform .08s linear;
      background: radial-gradient(circle at 30% 30%, var(--rat-primary, #f5d0fe), var(--rat-secondary, #a78bfa) 72%);
      box-shadow: inset -10px -8px rgba(0,0,0,.2), 0 8px 12px rgba(0,0,0,.35);
    }
    .rat::before,.rat::after {
      content: "";
      position: absolute;
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: color-mix(in oklab, var(--rat-primary, #f5d0fe) 80%, white);
      top: -5px;
      border: 2px solid rgba(0,0,0,.2);
    }
    .rat::before { left: 8px; }
    .rat::after { right: 8px; }
    .rat .eye { position: absolute; width: 6px; height: 6px; border-radius: 50%; top: 15px; right: 12px; background: #111; box-shadow: -16px 1px 0 #111; }
    .rat .nose { position: absolute; width: 9px; height: 7px; right: -2px; top: 20px; border-radius: 50%; background: #fb7185; }
    .rat .tail { position: absolute; width: 36px; height: 8px; left: -28px; top: 26px; border-radius: 10px; transform: rotate(-10deg); background: linear-gradient(90deg, #c084fc, #f9a8d4); }

    .food {
      position: absolute;
      width: 28px;
      height: 28px;
      font-size: 24px;
      display: grid;
      place-items: center;
      pointer-events: none;
    }

    .modal {
      position: fixed;
      inset: 0;
      background: rgba(2,6,23,.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 50;
      padding: 16px;
      backdrop-filter: blur(8px);
    }

    .modal.open { display: flex; }

    .sheet {
      width: min(760px, 100%);
      max-height: 85vh;
      overflow: auto;
      border-radius: 22px;
      padding: 16px;
      background: linear-gradient(180deg, rgba(255,255,255,.22), rgba(255,255,255,.12));
      border: 1px solid rgba(255,255,255,.25);
    }

    .row { display: flex; align-items: center; justify-content: space-between; gap: 10px; margin: 10px 0; }
    .card { border-radius: 16px; padding: 12px; background: rgba(15,23,42,.45); border: 1px solid rgba(255,255,255,.15); }

    input, select {
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,.25);
      background: rgba(15,23,42,.45);
      color: white;
      padding: 8px;
    }

    .leaderboard-item { display: grid; grid-template-columns: 28px 1fr auto; gap: 8px; padding: 8px 6px; border-bottom: 1px solid rgba(255,255,255,.1); }
    .status { font-weight: 700; min-height: 22px; color: #fde68a; margin-top: 6px; }

    @media (max-width: 760px) {
      .stats { grid-template-columns: repeat(2, 1fr); }
      #gameArea { min-height: 64vh; }
    }
  </style>
</head>
<body>
  <header class="top-panel">
    <div class="stats">
      <div class="pill">üêÄ Fat <span id="fatStat">0</span></div>
      <div class="pill">üßÄ Coins <span id="coinStat">0</span></div>
      <div class="pill">üìà Earned <span id="earnedStat">0</span></div>
      <div class="pill">üåç <span id="zoneStat">Alley</span></div>
    </div>
    <div class="button-row">
      <button class="ios-btn" id="openShopBtn">Boosts</button>
      <button class="ios-btn secondary" id="openZonesBtn">Zones</button>
      <button class="ios-btn" id="openRatBtn">Customize Rat</button>
      <button class="ios-btn secondary" id="openLeaderboardBtn">World Leaderboard</button>
    </div>
    <div class="pill">Move with WASD / Arrow Keys</div>
    <div class="status" id="statusMsg"></div>
  </header>

  <main id="gameArea" aria-label="Fat Rat Game Arena">
    <div id="rat" class="rat"><span class="tail"></span><span class="eye"></span><span class="nose"></span></div>
  </main>

  <div class="modal" id="shopModal">
    <div class="sheet">
      <div class="row"><h2>üõí Boost Shop</h2><button class="ios-btn secondary" data-close="#shopModal">Close</button></div>
      <div id="shopList"></div>
    </div>
  </div>

  <div class="modal" id="zonesModal">
    <div class="sheet">
      <div class="row"><h2>üîì Zones</h2><button class="ios-btn secondary" data-close="#zonesModal">Close</button></div>
      <div id="zonesList"></div>
    </div>
  </div>

  <div class="modal" id="ratModal">
    <div class="sheet">
      <div class="row"><h2>üé® Customize Rat</h2><button class="ios-btn secondary" data-close="#ratModal">Close</button></div>
      <div class="card">
        <div class="row"><label>Rat Name</label><input id="ratNameInput" maxlength="18" placeholder="Chunky" /></div>
        <div class="row"><label>Primary Color</label><input id="ratPrimaryInput" type="color" value="#f5d0fe" /></div>
        <div class="row"><label>Secondary Color</label><input id="ratSecondaryInput" type="color" value="#a78bfa" /></div>
        <div class="row"><label>Accessory</label>
          <select id="ratAccessoryInput">
            <option value="none">None</option>
            <option value="crown">Crown üëë</option>
            <option value="cap">Cap üß¢</option>
            <option value="glasses">Glasses üï∂Ô∏è</option>
          </select>
        </div>
        <button class="ios-btn" id="saveRatBtn">Save Customization</button>
      </div>
    </div>
  </div>

  <div class="modal" id="leaderboardModal">
    <div class="sheet">
      <div class="row"><h2>üèÜ World Leaderboard</h2><button class="ios-btn secondary" data-close="#leaderboardModal">Close</button></div>
      <div class="card">
        <div class="row"><label>Submit Name</label><input id="leaderboardNameInput" maxlength="18" placeholder="RatKing" /></div>
        <button class="ios-btn" id="submitScoreBtn">Submit My Score</button>
      </div>
      <div class="card" style="margin-top:10px">
        <div id="leaderboardList"></div>
      </div>
    </div>
  </div>

  <script>
    const zones = [
      { name: "Alley", unlockAt: 0, foodRate: 1100, foodFat: 1, bg: "linear-gradient(160deg,#334155,#1e293b)" },
      { name: "Food Court", unlockAt: 35, foodRate: 840, foodFat: 2, bg: "linear-gradient(160deg,#065f46,#022c22)" },
      { name: "Mega Buffet", unlockAt: 90, foodRate: 620, foodFat: 3, bg: "linear-gradient(160deg,#7f1d1d,#450a0a)" },
      { name: "Cosmic Kitchen", unlockAt: 180, foodRate: 500, foodFat: 4, bg: "linear-gradient(160deg,#312e81,#1e1b4b)" }
    ];

    const shopItems = [
      { id: "speed", name: "Rocket Sneakers", cost: 12, desc: "+0.9 movement speed", apply: s => s.speed += 0.9 },
      { id: "mult", name: "Grease Booster", cost: 20, desc: "+1 fat per bite", apply: s => s.fatPerFood += 1 },
      { id: "spawn", name: "Snack Magnet", cost: 28, desc: "Faster food spawns", apply: s => s.spawnBoost += 160 },
      { id: "coin", name: "Golden Whiskers", cost: 25, desc: "+1 coin per food", apply: s => s.coinBoost += 1 }
    ];

    const state = {
      fat: 0,
      coins: 0,
      totalFatEarned: 0,
      speed: 3.2,
      fatPerFood: 1,
      spawnBoost: 0,
      coinBoost: 0,
      zoneIndex: 0,
      highestUnlockedZone: 0,
      keys: {},
      foods: [],
      lastSpawn: 0,
      rat: { x: 220, y: 180, w: 64, h: 48 },
      ratName: "Chunky",
      ratPrimary: "#f5d0fe",
      ratSecondary: "#a78bfa",
      ratAccessory: "none",
      uiDirty: true
    };

    const gameArea = document.getElementById("gameArea");
    const ratEl = document.getElementById("rat");
    const fatStat = document.getElementById("fatStat");
    const coinStat = document.getElementById("coinStat");
    const earnedStat = document.getElementById("earnedStat");
    const zoneStat = document.getElementById("zoneStat");
    const statusMsg = document.getElementById("statusMsg");
    const shopList = document.getElementById("shopList");
    const zonesList = document.getElementById("zonesList");
    const leaderboardList = document.getElementById("leaderboardList");

    function currentZone() { return zones[state.zoneIndex]; }

    function setStatus(msg, color = "#fde68a") {
      statusMsg.textContent = msg;
      statusMsg.style.color = color;
      clearTimeout(setStatus.timer);
      setStatus.timer = setTimeout(() => (statusMsg.textContent = ""), 2000);
    }

    function openModal(id) { document.querySelector(id).classList.add("open"); }
    function closeModal(id) { document.querySelector(id).classList.remove("open"); }

    function renderHUD() {
      fatStat.textContent = state.fat;
      coinStat.textContent = state.coins;
      earnedStat.textContent = state.totalFatEarned;
      zoneStat.textContent = currentZone().name;
      gameArea.style.background = currentZone().bg;

      const visualScale = Math.min(1 + state.fat * 0.016, 3.4);
      ratEl.style.transform = `scale(${visualScale})`;

      // Bigger fat = bigger collection hitbox
      state.rat.w = 64 * Math.min(1 + state.fat * 0.01, 2.8);
      state.rat.h = 48 * Math.min(1 + state.fat * 0.01, 2.8);

      ratEl.style.setProperty("--rat-primary", state.ratPrimary);
      ratEl.style.setProperty("--rat-secondary", state.ratSecondary);
      ratEl.dataset.accessory = state.ratAccessory;
      ratEl.textContent = "";
      ratEl.insertAdjacentHTML("beforeend", `<span class="tail"></span><span class="eye"></span><span class="nose"></span>${accessoryHTML(state.ratAccessory)}`);
    }

    function accessoryHTML(accessory) {
      if (accessory === "crown") return `<span style="position:absolute;top:-20px;left:20px;font-size:20px">üëë</span>`;
      if (accessory === "cap") return `<span style="position:absolute;top:-18px;left:18px;font-size:20px">üß¢</span>`;
      if (accessory === "glasses") return `<span style="position:absolute;top:10px;left:14px;font-size:18px">üï∂Ô∏è</span>`;
      return "";
    }

    function renderShop() {
      shopList.innerHTML = "";
      shopItems.forEach(item => {
        const canBuy = state.coins >= item.cost;
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `<div class="row"><div><strong>${item.name}</strong><div>${item.desc}</div><div>${item.cost} coins</div></div><button class="ios-btn" data-buy="${item.id}" ${canBuy ? "" : "disabled"}>${canBuy ? "Buy" : "Need Coins"}</button></div>`;
        shopList.appendChild(card);
      });
    }

    function renderZones() {
      zonesList.innerHTML = "";
      zones.forEach((zone, idx) => {
        const open = state.totalFatEarned >= zone.unlockAt;
        const current = idx === state.zoneIndex;
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `<div class="row"><div><strong>${zone.name}</strong><div>Unlock: ${zone.unlockAt} fat</div><div>Food bonus: +${zone.foodFat - 1}</div></div><button class="ios-btn secondary" data-zone="${idx}" ${(!open || current) ? "disabled" : ""}>${current ? "Current" : open ? "Travel" : "Locked"}</button></div>`;
        zonesList.appendChild(card);
      });
    }

    function loadLeaderboard() {
      const saved = JSON.parse(localStorage.getItem("fatRatLeaderboard") || "[]");
      const npc = [
        { name: "BurgerBeast", fat: 420 },
        { name: "FriesPhantom", fat: 350 },
        { name: "CheeseWhale", fat: 260 },
        { name: "GreaseKing", fat: 200 }
      ];
      const merged = [...saved, ...npc]
        .sort((a, b) => b.fat - a.fat)
        .slice(0, 20);
      return merged;
    }

    function renderLeaderboard() {
      const board = loadLeaderboard();
      leaderboardList.innerHTML = "";
      board.forEach((entry, i) => {
        const row = document.createElement("div");
        row.className = "leaderboard-item";
        row.innerHTML = `<div>${i + 1}.</div><div>${entry.name}</div><div>${entry.fat} fat</div>`;
        leaderboardList.appendChild(row);
      });
    }

    function submitScore() {
      const nameInput = document.getElementById("leaderboardNameInput");
      const name = (nameInput.value || state.ratName || "FatRat").trim().slice(0, 18);
      const saved = JSON.parse(localStorage.getItem("fatRatLeaderboard") || "[]");
      saved.push({ name, fat: state.totalFatEarned, ts: Date.now() });
      localStorage.setItem("fatRatLeaderboard", JSON.stringify(saved));
      renderLeaderboard();
      setStatus("Score submitted to world leaderboard!", "#86efac");
    }

    function buyItem(id) {
      const item = shopItems.find(i => i.id === id);
      if (!item) return;
      if (state.coins < item.cost) return;
      state.coins -= item.cost;
      item.apply(state);
      state.uiDirty = true;
      setStatus(`Bought ${item.name}!`, "#86efac");
    }

    function travelToZone(idx) {
      const zone = zones[idx];
      if (!zone) return;
      if (state.totalFatEarned < zone.unlockAt || state.zoneIndex === idx) return;
      state.zoneIndex = idx;
      state.uiDirty = true;
      setStatus(`Traveled to ${zone.name}`, "#86efac");
    }

    function maybeAutoUnlockAndTravel() {
      let newest = 0;
      for (let i = zones.length - 1; i >= 0; i--) {
        if (state.totalFatEarned >= zones[i].unlockAt) { newest = i; break; }
      }
      if (newest > state.highestUnlockedZone) {
        state.highestUnlockedZone = newest;
        state.zoneIndex = newest;
        state.uiDirty = true;
        setStatus(`${zones[newest].name} unlocked! Auto-traveled üöÄ`, "#86efac");
      }
    }

    function spawnFood() {
      const zone = currentZone();
      const emoji = Math.random() > 0.45 ? "üçî" : "üçü";
      const food = {
        id: Math.random().toString(36).slice(2),
        x: Math.random() * (gameArea.clientWidth - 32),
        y: Math.random() * (gameArea.clientHeight - 32),
        fatValue: zone.foodFat + state.fatPerFood - 1,
        coinValue: (emoji === "üçî" ? 3 : 2) + state.coinBoost,
        emoji
      };
      state.foods.push(food);
      const el = document.createElement("div");
      el.id = food.id;
      el.className = "food";
      el.style.left = `${food.x}px`;
      el.style.top = `${food.y}px`;
      el.textContent = food.emoji;
      gameArea.appendChild(el);
    }

    function intersects(a, b) {
      return a.x < b.x + b.w && a.x + a.w > b.x && a.y < b.y + b.h && a.y + a.h > b.y;
    }

    function clampRat() {
      state.rat.x = Math.max(2, Math.min(state.rat.x, gameArea.clientWidth - state.rat.w - 2));
      state.rat.y = Math.max(2, Math.min(state.rat.y, gameArea.clientHeight - state.rat.h - 2));
    }

    function updateRat() {
      if (state.keys.ArrowUp || state.keys.w) state.rat.y -= state.speed;
      if (state.keys.ArrowDown || state.keys.s) state.rat.y += state.speed;
      if (state.keys.ArrowLeft || state.keys.a) state.rat.x -= state.speed;
      if (state.keys.ArrowRight || state.keys.d) state.rat.x += state.speed;
      clampRat();
      ratEl.style.left = `${state.rat.x}px`;
      ratEl.style.top = `${state.rat.y}px`;
    }

    function collectFood() {
      const ratBox = { x: state.rat.x, y: state.rat.y, w: state.rat.w, h: state.rat.h };
      let gained = false;
      state.foods = state.foods.filter(food => {
        const hit = intersects(ratBox, { x: food.x, y: food.y, w: 24, h: 24 });
        if (!hit) return true;
        state.fat += food.fatValue;
        state.totalFatEarned += food.fatValue;
        state.coins += food.coinValue;
        document.getElementById(food.id)?.remove();
        gained = true;
        return false;
      });
      if (gained) state.uiDirty = true;
    }

    function renderAll() {
      renderHUD();
      renderShop();
      renderZones();
      renderLeaderboard();
      state.uiDirty = false;
    }

    function gameLoop(ts) {
      const spawnEvery = Math.max(240, currentZone().foodRate - state.spawnBoost);
      if (ts - state.lastSpawn > spawnEvery && state.foods.length < 20) {
        spawnFood();
        state.lastSpawn = ts;
      }

      updateRat();
      collectFood();
      maybeAutoUnlockAndTravel();

      if (state.uiDirty) renderAll();
      else renderHUD();

      requestAnimationFrame(gameLoop);
    }

    document.getElementById("openShopBtn").addEventListener("click", () => openModal("#shopModal"));
    document.getElementById("openZonesBtn").addEventListener("click", () => openModal("#zonesModal"));
    document.getElementById("openRatBtn").addEventListener("click", () => openModal("#ratModal"));
    document.getElementById("openLeaderboardBtn").addEventListener("click", () => openModal("#leaderboardModal"));

    document.querySelectorAll("[data-close]").forEach(btn => btn.addEventListener("click", () => closeModal(btn.dataset.close)));

    shopList.addEventListener("click", e => {
      const btn = e.target.closest("button[data-buy]");
      if (!btn) return;
      buyItem(btn.dataset.buy);
    });

    zonesList.addEventListener("click", e => {
      const btn = e.target.closest("button[data-zone]");
      if (!btn) return;
      travelToZone(Number(btn.dataset.zone));
    });

    document.getElementById("saveRatBtn").addEventListener("click", () => {
      state.ratName = document.getElementById("ratNameInput").value.trim() || "Chunky";
      state.ratPrimary = document.getElementById("ratPrimaryInput").value;
      state.ratSecondary = document.getElementById("ratSecondaryInput").value;
      state.ratAccessory = document.getElementById("ratAccessoryInput").value;
      state.uiDirty = true;
      setStatus("Rat customization saved!", "#86efac");
    });

    document.getElementById("submitScoreBtn").addEventListener("click", submitScore);

    window.addEventListener("keydown", e => {
      state.keys[e.key] = true;
      state.keys[e.key.toLowerCase()] = true;
    });

    window.addEventListener("keyup", e => {
      state.keys[e.key] = false;
      state.keys[e.key.toLowerCase()] = false;
    });

    window.addEventListener("resize", clampRat);

    renderAll();
    requestAnimationFrame(gameLoop);
  </script>
</body>
</html>
